### 11.5 AGENTS.md 规范指南

AGENTS.md 是一个由 OpenAI 发起的开放标准，旨在为 AI 编程 Agent 提供项目级的指令和上下文。它于 2025 年 12 月被捐赠给 Linux Foundation 的 Agentic AI Foundation (AAIF)。

####  什么是 AGENTS.md

#### 核心概念

如果说 `README.md` 是给人类开发者看的项目说明，那么 `AGENTS.md` 就是给 AI 编程 Agent 看的"机器可读说明书"。

> **类比**：  
> - `README.md` → 人类开发者的项目介绍  
> - `AGENTS.md` → AI 编程 Agent 的工作指南

#### 为什么需要 AGENTS.md

传统的 README.md 存在以下问题：

1. **面向人类**：包含快速入门、项目描述等人类易读但机器难以精确解析的内容
2. **信息分散**：构建命令、测试规则、代码风格等信息可能散落在多个文件中
3. **格式不统一**：每个项目的写法不同，Agent 需要"猜测"

AGENTS.md 通过标准化格式解决这些问题：

- 给 Agent 一个**清晰、可预测**的指令位置
- 提供**精确、步骤化**的操作指南
- 保持 README 简洁，专注人类读者

####  文件结构

#### 基本布局

```
project-root/
├── README.md           # 给人类看的项目说明
├── AGENTS.md           # 给 AI Agent 看的工作指南
├── src/
│   └── AGENTS.md       # 可选：子目录特定指令
└── tests/
    └── AGENTS.md       # 可选：测试目录特定指令
```

#### 嵌套规则

- 根目录的 `AGENTS.md` 适用于整个项目
- 子目录的 `AGENTS.md` 可以覆盖或补充父目录的指令
- 适用于 Monorepo 等大型项目

####  推荐内容结构

一个完整的 AGENTS.md 通常包含以下部分：

#### 1. 项目概述

```markdown
# Project Overview

This is a TypeScript-based web application using Next.js 14.
Architecture: Monorepo with apps/ and packages/ directories.
```

#### 2. 构建与测试命令

```markdown
# Build & Test

###  Build
npm run build

###  Test
npm run test              # 运行所有测试
npm run test:unit         # 仅单元测试
npm run test:e2e          # 端到端测试

###  Lint
npm run lint              # ESLint + Prettier
```

#### 3. 代码风格指南

```markdown
# Code Style

- Use TypeScript strict mode
- Prefer functional components over class components
- Use named exports, avoid default exports
- Maximum line length: 100 characters
- Use `const` by default, `let` only when necessary
```

#### 4. 测试规范

```markdown
# Testing Guidelines

- All new features must have unit tests
- Test files should be co-located: `foo.ts` → `foo.test.ts`
- Use `describe` for grouping, `it` for individual tests
- Mock external APIs in tests
```

#### 5. 安全考虑

```markdown
# Security

- Never commit secrets or API keys
- Use environment variables for configuration
- Validate all user input
- Avoid `eval()` and `dangerouslySetInnerHTML`
```

#### 6. Pull Request 指南

```markdown
# Pull Request Guidelines

- Keep PRs focused and small (< 500 lines changed)
- Write meaningful commit messages
- Include tests for new functionality
- Update documentation if needed
```

####  完整示例

```markdown
# AGENTS.md

###  Project Overview

A Python REST API built with FastAPI.
- Framework: FastAPI 0.100+
- Database: PostgreSQL with SQLAlchemy ORM
- Authentication: JWT tokens

###  Environment Setup

```bash
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt
cp .env.example .env
```

###  Build & Run

```bash
## Development
uvicorn app.main:app --reload

## Production
uvicorn app.main:app --host 0.0.0.0 --port 8000
```

###  Test Commands

```bash
## Run all tests
pytest

## Run with coverage
pytest --cov=app --cov-report=html

## Run specific test file
pytest tests/test_users.py
```

###  Code Style

- Follow PEP 8
- Use type hints for all function parameters and returns
- Docstrings in Google style
- Max line length: 88 (Black formatter)

###  File Naming

- API routes: `app/routers/{resource}.py`
- Models: `app/models/{entity}.py`
- Schemas: `app/schemas/{entity}.py`
- Tests: `tests/test_{module}.py`

###  Security

- Validate all input with Pydantic models
- Use parameterized queries (SQLAlchemy handles this)
- Never log passwords or tokens
- Rate limit all public endpoints
```

####  支持的 AI 工具

AGENTS.md 已被以下 AI 编程工具原生支持：

| 工具 | 厂商 | 支持状态 |
|------|------|----------|
| Codex | OpenAI | ✅ 原生支持 |
| GitHub Copilot (Coding Agent) | GitHub | ✅ 原生支持 |
| Cursor | Cursor | ✅ 原生支持 |
| VS Code | Microsoft | ✅ 原生支持 |
| Gemini CLI / Jules | Google | ✅ 原生支持 |
| Devin | Cognition | ✅ 原生支持 |
| Windsurf | Codeium | ✅ 原生支持 |
| Aider | 开源 | ✅ 原生支持 |
| goose | Block | ✅ 原生支持 |
| Zed | Zed Industries | ✅ 原生支持 |

####  与其他配置文件的关系

AGENTS.md 旨在**统一**而非取代现有的工具特定配置：

| 工具 | 专用配置 | AGENTS.md 的作用 |
|------|----------|-----------------|
| Cursor | `.cursor/rules` | 提供通用指令 |
| Cline | `.clinerules` | 提供通用指令 |
| Aider | `.aider.conf` | 提供项目上下文 |

**最佳实践**：将通用指令放在 AGENTS.md，工具特定配置放在各自文件中。

#### 11.5.5 高级技巧：渐进式披露 (Progressive Disclosure)

不要试图把所有信息都塞进一个 `AGENTS.md`。这会消耗 Token 并降低 Agent 的注意力。

**推荐结构**：
```
agent_docs/
  ├── architecture.md
  ├── testing_guide.md
  └── database_schema.md
AGENTS.md (只包含索引和指针)
```

在 `AGENTS.md` 中：
> "关于数据库设计细节，请阅读 `agent_docs/database_schema.md`。"

Agent 会在需要时自行读取子文档，而不是每次都背负所有知识。

#### 11.5.6 核心原则：What / Why / How

一个好的配置文件应该回答三个问题：
1.  **WHAT**: 技术栈、项目结构（Monorepo 里的各部分职责）。
2.  **WHY**: 设计决策的背景（为什么这么设计？历史包袱是什么？）。
3.  **HOW**: 如何运行、测试、验证。

#### 11.5.7 反模式：不要做 Linter 的工作

❌ **错误做法**：在 Prompt 中写几百行的代码风格指南（空格还是 Tab、大括号换行）。
*   **后果**：浪费 Token，Agent 记不住，且执行不稳定。

✅ **正确做法**：使用 ESLint / Prettier / Ruff。
*   让工具自动修复格式与 Lint 错误。
*   Agent 只需要知道 "run `npm run lint:fix` before commit"。

#### 11.5.8 采用建议

#### 快速开始

1. 在项目根目录创建 `AGENTS.md` 文件
2. 复制上面的模板并根据项目调整
3. 重点填写**构建命令**和**代码风格**部分

#### 逐步完善

- 第一周：基础构建和测试命令
- 第二周：代码风格和命名规范
- 第三周：安全规则和 PR 指南
- 持续：根据 Agent 表现调整和补充

#### 验证效果

使用 AI 编程 Agent 进行以下测试：

1. "请添加一个新的 API 端点"——检查是否遵循文件命名规范
2. "请为这个函数添加测试"——检查测试是否放在正确位置
3. "请修复这个 bug"——检查是否运行了测试套件

####  相关资源

- **官方网站**：https://agents.md
- **GitHub 仓库**：https://github.com/agenticaifoundation/agents-md
- **AAIF 官网**：https://aaif.io
- **讨论区**：GitHub Issues

---

####  与 CLAUDE.md 的对比

Anthropic 的 Claude Code 使用 `CLAUDE.md` 作为项目配置文件，与 AGENTS.md 有相似之处但定位不同。

##### 对比表

| 维度 | AGENTS.md | CLAUDE.md |
|------|-----------|-----------|
| 标准化 | AAIF 开放标准 | Anthropic 专属 |
| 适用范围 | 所有支持的 AI 工具 | 仅 Claude Code |
| 层级位置 | 项目根目录 + 子目录 | 项目根目录 + 父目录 + 用户目录 |
| 核心内容 | 构建命令、测试、代码风格 | 项目上下文、工作流、MCP 配置 |
| 加载方式 | 工具主动读取 | 作为系统提示词注入 |

##### 互补关系

两者可以在同一项目中共存：

- **AGENTS.md**：存放通用的、跨工具的指令（构建命令、代码规范、安全规则）
- **CLAUDE.md**：存放 Claude Code 特有的配置（MCP 服务器集成、Hooks 触发规则）

```
project-root/
├── AGENTS.md           # 通用 Agent 指令
├── CLAUDE.md           # Claude Code 专属配置
├── .cursor/rules       # Cursor 专属配置
└── src/
    └── AGENTS.md       # 子目录特定指令
```

##### CLAUDE.md 特有功能

1. **项目地图**：描述目录结构和架构模式
2. **工具连接**：配置 MCP 服务器和使用说明
3. **工作流定义**：定义常用的多步骤流程
4. **自定义命令**：创建 `/` 前缀的快捷命令
5. **上下文管理**：使用 `/clear` 和 subagent 控制上下文

> [!TIP]
> **最佳实践**：将通用指令放在 AGENTS.md（跨工具生效），将 Claude 特定配置放在 CLAUDE.md（如 MCP 集成、Hooks 配置）。

---

> [!TIP]
> AGENTS.md 是一个不断演进的标准。建议关注 AAIF 官方动态，了解规范的最新发展。

