## 1.5 智能体工作流

智能体工作流（Agentic Workflow）是一类重要的 AI 应用范式。与传统的单次推理不同，它强调将 AI 能力组织成可控、可观测、可迭代的工作流程。

### 1.5.1 什么是智能体工作流

智能体工作流是一种让 AI 系统以 **迭代、自主、目标导向**的方式完成复杂任务的工作模式。**核心特征**：

- **迭代式执行**：不是一次生成最终答案，而是多步骤逐渐逼近目标
- **自主决策**：AI 自主决定下一步行动，而非完全由用户控制
- **工具集成**：无缝调用外部工具和服务
- **状态管理**：维护执行过程中的中间状态

### 1.5.2 与传统提示词模式的区别

| 维度 | **传统提示词**|**智能体工作流** |
|------|-------------|------------------|
| 交互模式 | 单次请求-响应 | 多轮迭代执行 |
| 控制权 | 用户完全控制 | AI 自主决策 |
| 执行时间 | 毫秒到秒级 | 秒到分钟级 |
| 能力边界 | 模型内在知识 | 工具扩展后的能力 |
| 结果质量 | 依赖 **提示词** 质量 | 可通过迭代改进 |

### 1.5.3 典型的智能体工作流模式

典型的智能体工作流模式包括：规划-执行模式、ReAct 模式、反思-改进模式、层级协作模式。

#### 规划-执行模式

智能体会先制定完整计划，然后逐步执行，直到达到目标。这个模式通常用于结构化任务、可预测的工作流程。

```
用户目标
    ↓
[规划阶段] 生成任务步骤列表
    ↓
[执行阶段] 逐步执行每个步骤
    ↓
最终结果
```

**适用场景**：结构化任务、可预测的工作流程

#### ReAct 模式

ReAct 是 Reasoning and Acting 的缩写，是推理和行动交替进行的模式。智能体会先进行推理，然后根据推理结果执行行动，再观察行动结果，如此循环直到达到目标。

```
Thought: 我需要先了解用户的代码结构
Action: 读取项目目录
Observation: 发现是一个 Python 项目...
Thought: 现在我需要分析主入口文件
Action: 读取 main.py
...
```

**适用场景**：探索性任务、需要动态调整的场景

#### 反思-改进模式

智能体会在执行后进行自我评估和改进，这个模式通常用于需要质量把控的任务。

```
初始方案 → 执行 → 评估结果 → 反思问题 → 改进方案 → 重新执行
```

**适用场景**：代码编写、内容创作等需要质量把控的任务

#### 多智能体协作模式

多个专业化智能体分别担任不同角色，协同完成任务。这个模式通常用于复杂项目、需要多种专业技能的任务。

```
用户需求
    ↓
[协调者智能体] 分配任务
    ↓
[研究智能体] ←→ [写作智能体] ←→ [审核智能体]
    ↓
整合输出
```

**适用场景**：复杂项目、需要多种专业技能的任务


### 1.5.4 实践案例

以下是几个典型的智能体工作流应用案例，展示了上述模式在实际产品中的落地（以“产品形态”而非具体品牌为例）：

#### 案例一：交互式产物视图

一些交互式界面会将“产物”与“对话”并列呈现，常见地采用 **反思-改进模式**：

- **即时预览**：生成代码后立即渲染展示
- **迭代改进**：用户可以要求修改，智能体理解上下文逐步完善
- **工具集成**：支持 HTML/CSS/JS、React、Mermaid 图表等

#### 案例二：AI 原生 IDE

现代 AI IDE 的代码编辑工作流常结合 **规划-执行模式**与**反思-改进模式**：

```
1. 用户描述需求
2. 智能体分析代码库
3. 生成修改计划
4. 逐文件编辑
5. 自动验证（运行测试、检查类型）
6. 必要时自动修复问题
```

#### 案例三：自主软件开发智能体

自主软件开发智能体常综合运用 **ReAct** 模式和 **多智能体协作** 模式：

- 完整的开发环境访问
- 自主执行 git 操作
- 运行测试并修复问题
- 与用户进行异步协作

#### 案例四：企业级智能体生产流程

本案例展示某金融科技公司如何将智能体从实验推向生产环境。

* **案例背景**
    * **场景**：企业内部研报生成与合规审查。
    * **痛点**：分析师撰写研报耗时（平均 4h/篇），且合规审查易漏检，导致发布延迟。

* **目标设定**
    * **核心目标**：自动化生成并初审研报。
    * **关键指标**：研报生成时间 < 10min，合规漏检率 < 1%。

* **解决方案**
    * **架构设计**：采用 **Hierarchical Collaboration（层级协作）** 模式。
    * **关键技术**：
        * **规划智能体**：负责拆解研报结构。
        * **撰写智能体**：并行撰写各章节，利用其强推理能力保证逻辑深度。
        * **审查智能体**：基于 RAG 检索最新合规条款进行审查。
    * **工作流**：

    ```mermaid
    graph LR
        %% Agentic Design System
        classDef user fill:#fff7e6,stroke:#fa8c16,stroke-width:2px;
        classDef agent fill:#e6f7ff,stroke:#1890ff,stroke-width:2px;
        classDef tool fill:#f6ffed,stroke:#52c41a,stroke-width:2px;

        User([用户请求]) --> Planner[规划智能体]
        Planner -->|分发大纲| WriterA[宏观分析智能体]
        Planner -->|分发大纲| WriterB[行业分析智能体]
        WriterA & WriterB --> aggregator[内容聚合]
        aggregator --> Reviewer[审查智能体]
        Reviewer -->|未通过| Planner
        Reviewer -->|通过| Output([最终研报])
        
        class User user;
        class Planner,WriterA,WriterB,Reviewer agent;
        class aggregator tool;
        class Output user;
    ```

    图 1-4：金融研报生成层级协作工作流

* **实施成效**
    * **效率**：生成时间从数小时骤降至 10 分钟内。
    * **质量**：合规审查首次通过率提升至 95% 以上。

* **风险与教训**
    * **模型幻觉**：初期曾编造数据，后引入 **工具使用** 强制联网验证数据源。
* **成本控制**：在非核心章节切换为低成本模型，平衡质量与成本。

#### 案例五：跨国软件团队的协作案例

本案例展示某 SaaS 公司如何利用智能体工作流解决跨时区协作痛点。

* **背景**
    * **场景**：一家多语言产品线的 SaaS 公司，拥有分布在美、欧、亚的研发团队。
    * **痛点**：人工处理需求分析与测试用例生成效率低，跨区域信息同步滞后，缺陷回归周期较长。

* **目标**
    * **核心目标**：将“需求梳理→架构评审→代码草拟→测试生成”流程全面自动化。
    * **关键指标**：需求梳理时间缩短，缺陷回归周期压缩。

* **解决方案**
    * **架构设计**：基于图式工作流构建的有环编排。
    * **核心角色**：
        * **计划智能体**：负责根据 PRD 生成技术方案大纲。
        * **执行智能体**：根据大纲生成脚手架代码。
        * **测试智能体**：自动生成测试用例并执行回归测试。
        * **人工节点**：关键节点的架构评审与代码合并审批。
    * **协同机制**：结合 **RAG** 检索企业内部知识库（Wiki/Jira），确保生成的方案符合公司技术规范。

* **成效**
    * **效率**：需求梳理时间从一周缩短至 2 天。
    * **速度**：缺陷回归测试周期压缩近 60%。
    * **协作**：减少时差带来的等待成本，智能体可持续处理流水线任务。

### 1.5.5 实现智能体工作流的关键要素

#### 状态管理

```python
class AgentState:
    goal: str                    # 最终目标
    current_step: int            # 当前步骤
    plan: List[str]              # 执行计划
    memory: List[Message]        # 对话历史
    tool_results: Dict           # 工具调用结果
    errors: List[str]            # 错误记录
```

#### 控制流

- **循环机制**：直到达成目标或超时
- **分支判断**：根据中间结果调整路径
- **错误处理**：失败时的重试或回退策略
- **终止条件**：明确的完成标准

#### 人机交互点

- **审批节点**：关键操作前询问用户
- **信息补充**：缺少必要信息时请求输入
- **进度反馈**：实时展示执行状态

### 1.5.6 最佳实践

#### 建议 ✅

- **设置明确的终止条件**：避免无限循环
- **实现渐进式披露**：先执行低风险操作
- **提供取消机制**：用户可随时中断
- **记录完整轨迹**：便于调试和审计

#### 禁止 ❌

- **不要过度自主**：重大决策应询问用户
- **不要忽略错误**：每个失败都应该被处理
- **不要无限重试**：设置最大尝试次数
- **不要隐藏过程**：透明度建立信任

---

**下一节**: [本章小结](summary.md)
