## 10.3 常见工具

本节按工具出现的时间顺序，详细介绍当前最主流的智能体编程工具，包括它们的核心能力、使用技巧和最佳实践。

### 10.3.1 GitHub Copilot Agent

GitHub Copilot 最早于 2022 年推出代码补全功能，其智能体模式深度集成 GitHub 生态。

#### 核心场景

| 场景 | 描述 | 触发方式 |
|------|------|---------|
| **Issue → PR** | 自动根据 Issue 生成代码 | 添加 label |
| **代码审查** | 自动审查 PR 并提供建议 | PR 打开时 |
| **安全扫描** | 自动检测和修复漏洞 | 推送代码时 |
| **文档生成** | 自动生成/更新文档 | 代码变更时 |

#### 配置示例


> **注意**：以下为示意配置，GitHub Copilot Agent 的实际配置格式可能有所不同，请参考官方文档。

```yaml
# .github/copilot-agent.yml

name: Copilot Agent

on:
  issues:
    types: [labeled]

jobs:
  implement:
    if: contains(github.event.label.name, 'copilot-implement')
    runs-on: ubuntu-latest
    steps:
      - uses: github/copilot-agent@v1
        with:
          task: implement-issue
          auto-pr: true
          review-required: true
          
  code-review:
    if: github.event_name == 'pull_request'
    runs-on: ubuntu-latest
    steps:
      - uses: github/copilot-agent@v1
        with:
          task: review-pr
          security-scan: true
          style-check: true
```

#### Copilot Workspace vs Copilot Agent

需要区分两个概念：
*   **Copilot Agent** (本节重点)：运行在 GitHub Action 中的自动化机器人，处理异步任务。
*   **Copilot Workspace**：VS Code/Web 端的交互式环境，用于辅助编写代码。

Workspace 示例：
```
@workspace /explain 解释这个项目的架构
@workspace /fix 修复当前文件的所有警告
@workspace /tests 为选中的代码生成测试
@workspace /doc 更新这个函数的文档
```

### 10.3.2 Cursor

Cursor 于 2023 年推出，是流行的 AI 原生 IDE 之一，基于 VS Code 构建，专为智能体编程设计。

#### 核心能力

| 能力 | 描述 | 快捷键 |
|------|------|-------|
| **全代码库理解** | 索引整个项目，理解文件关系和代码逻辑 | 自动 |
| **智能体模式** | 自主完成复杂任务，跨文件修改 | `Cmd+I` |
| **MCP 支持** | 连接外部工具和数据源 | 自动 |
| **Composer** | 多文件编辑的对话界面 | `Cmd+Shift+I` |
| **@ 引用** | 精确指定上下文 | `@` |
| **规划模式** | 先规划后执行 | `Shift+Tab` |

#### @ 引用系统

Cursor 的 @ 引用是精确控制上下文的关键：

```
@file          引用单个文件
@folder        引用整个文件夹
@code          引用代码片段
@docs          引用项目文档
@git           引用 Git 历史
@web           搜索网络
@past_chats    引用历史对话
@definitions   引用符号定义
```

**使用示例**：

```markdown
用户：@src/api/users.py 这个函数有性能问题，用户量大时会很慢。
      参考 @src/api/orders.py 中的缓存模式帮我优化。

Cursor 智能体：
1. 分析 users.py 中的函数...
2. 识别性能瓶颈：N+1 查询问题
3. 参考 orders.py 的缓存实现
4. 规划优化方案：
   - 添加 Redis 缓存层
   - 批量查询优化
   - 添加缓存失效逻辑
5. 修改 users.py...
6. 创建 cache.py 缓存模块...
7. 更新 requirements.txt 添加 redis 依赖...
8. 运行测试验证...

完成！已优化函数并添加缓存，响应时间从 2.3s 降至 45ms。
```

#### 上下文管理

Cursor 智能体有强大的搜索工具，能按需自动拉取 [上下文](../03_memory/3.6_context_engineering.md)，无需手动标记每个文件。关于上下文管理的详细策略（何时开新对话、引用过去工作、AGENTS.md 等），见 [开发方法论](10.4_workflow.md)。

#### Rules 配置

在 `.cursor/rules/` 目录下创建 Markdown 文件来配置项目规则：

```markdown
# .cursor/rules/project.md

## 代码风格

- 使用 ES modules (import/export)，不用 CommonJS (require)
- 尽可能解构导入：`import { foo } from 'bar'`
- 参见 `components/Button.tsx` 作为规范组件结构

## 命令

- `npm run build`: 构建项目
- `npm run typecheck`: 运行类型检查
- `npm run test`: 运行测试

## 工作流

- 做完一系列代码更改后总是运行类型检查
- API 路由放在 `app/api/` 并遵循现有模式
- 不要修改 `generated/` 目录下的文件

## 禁止操作

- 不要删除任何测试文件
- 不要修改 .env 文件
- 不要直接操作数据库
```

**Skills（动态能力）**：

与 Rules (静态上下文) 不同，Skills 在智能体判断相关时才动态加载。Skills 可以包含：
- 自定义命令：可复用的工作流，通过 `/` 触发
- Hooks：在智能体动作前后运行的脚本
- 领域知识：智能体可按需拉取的特定任务指令
- **MCP 工具**：挂载标准化的 MCP 服务（如 Postgres, Stripe 等）

关于 Skills 和 Hooks 的详细设计模式，见 [工程化实践](10.5_best_practices.md)。

#### 高级特性

Cursor 还提供以下高级特性：

- **规划模式**：按 `Shift+Tab` 激活，先研代码库后制定计划再执行
- **并行智能体**：利用 Git Worktree 运行多个独立智能体
- **TDD 工作流**：先写测试再让智能体实现，提供明确迭代目标
- **调试模式**：假设驱动的 Bug 定位方法

### 10.3.3 Cline

Cline 于 2024 年 10 月从 Claude-dev 更名而来，是一个开源的 VS Code 扩展。对于对数据隐私有严格要求（如金融、军工）或希望降低 Token 成本的开发者，基于 Cline 的 **本地化智能体编程**是一个不错的选择。

#### 核心组合

典型的本地化开源组合方案如下：

**Cline** + **Ollama** + **DeepSeek-V3/R1**

*   **Cline**：一个开源的 VS Code 扩展，能够像 Cursor 一样读取文件、执行终端命令和编辑代码。
*   **Ollama**：本地大模型运行时。
*   **DeepSeek-R1**：表现出色的开源推理模型，在编程任务上接近闭源模型水准。

#### 配置指南

1. **安装工具**：
   ```bash
   # 1. 安装 Ollama

   brew install ollama
   
   # 2. 拉取模型 (推荐 32b 或 70b 版本以获得足够智商)

   ollama run deepseek-r1:32b
   ```

2. **配置 Cline**：
   *   在 VS Code 中安装 "Cline" 插件。
   *   API Provider 选择 "Ollama"。
   *   Model ID 输入 `deepseek-r1:32b`。

#### 优势与局限

| 维度 | 本地化方案（Cline + Local LLM） | 云端方案（Cursor/Claude） |
|------|-------------------------------|------------------------|
| **隐私** | ✅ **数据不出域**，绝对安全 | ❌ 代码需上传云端 |
| **成本** | ✅ **零 API 费用** (需自备 GPU) | ❌ 按 Token 计费 |
| **智力** | ⚠️ 取决于显存大小 (32B/70B) | ✅ SOTA 模型 (Claude 4.6 / GPT-5.3) |
| **速度** | ⚠️ 取决于本地算力 | ✅ 极快 |
| **体验** | 🛠️ 需要折腾配置 | ✅ 开箱即用 |

#### 最佳实践

*   **混合模式**：日常代码补全使用本地小模型 (如 Qwen-2.5-Coder-7B) 实现低延迟；复杂的架构设计和重构任务切换到云端 DeepSeek API 或本地高参数模型。
*   **企业私有化部署**：企业可以在内网部署 vLLM 提供 OpenAI 兼容接口，Cline 指向内网地址，既保证安全又利用集中算力。

### 10.3.4 Claude Code

Claude Code 于 2025 年 2 月发布，是 Anthropic 的 CLI 智能体工具，专为终端工作流设计，目前也支持桌面版和 IDE 插件。

#### 安装与配置


```bash
# 安装

npm install -g @anthropic-ai/claude-code

# 配置 API Key

export ANTHROPIC_API_KEY="sk-ant-xxx"

# 验证安装

claude --version
```

#### 基本使用


```bash
# 单次任务

claude "重构这个目录下的测试文件，使用 pytest 风格"

# 多文件分析

claude "分析 src/ 目录，找出所有未使用的导入"

# Git 集成

claude "分析最近 10 个 commit，生成 CHANGELOG"

# 代码审查

claude "审查 @src/api/auth.py 的安全性"
```

#### 交互模式

以下是一个交互示例：


```bash
# 启动交互模式

claude

> 帮我理解这个代码库的架构
[分析中...]

架构概览：
- 前端：Next.js + TypeScript
- 后端：FastAPI + SQLAlchemy
- 数据库：PostgreSQL
- 缓存：Redis

> 找出所有硬编码的配置值
[搜索中...]

发现 15 处硬编码配置：
1. src/config.py:23 - 数据库连接串
2. src/api/email.py:45 - SMTP 服务器地址
...

> 帮我把它们迁移到环境变量
[执行中...]
```

#### CLAUDE.md 项目记忆

在项目根目录创建 `CLAUDE.md` 作为持久化记忆：

```markdown
# CLAUDE.md

## 项目概述

这是一个 B2B SaaS 平台的后端服务。

## 技术栈

- Python 3.12 + FastAPI
- PostgreSQL + Redis
- Docker + Kubernetes

## 代码约定

- 使用 Black 格式化
- 测试覆盖率 > 80%
- 所有 API 必须有 OpenAPI 文档

## 当前任务

- [ ] 优化数据库查询性能
- [ ] 实现多租户隔离

## 已知问题

- 用户表缺少索引，大量查询时性能差
- 缓存失效策略不一致
```

#### 技能系统

Claude Code 支持加载自定义技能：

```
.claude/skills/
├── sql-analysis/
│   ├── SKILL.md
│   └── references/
│       ├── schema.md
│       └── queries.md
├── code-review/
│   ├── SKILL.md
```

> **MCP 一等公民**：Claude Code 的技能系统底层完全兼容 **MCP (Model Context Protocol)**。你可以直接挂载任何 MCP Server，让 Agent 安全地操作数据库、Slack 或 GitHub，而无需编写自定义胶水代码。

#### 钩子系统

钩子允许在智能体生命周期中注入自定义逻辑：

```typescript
// .claude/hooks/pre-commit.ts
export default async function(context: HookContext) {
  // 在每次提交前运行
  const result = await context.runCommand('npm run lint');
  
  if (!result.success) {
    return {
      block: true,
      message: 'Lint 检查未通过，请修复后再提交'
    };
  }
  
  return { block: false };
}
```

### 10.3.5 Codex

Codex 由 OpenAI 于 2025 年 4 月开源发布（Apache 2.0 许可），最早是一个终端智能体工具，由专用的 codex-1 模型（基于 o3 优化）驱动。目前已经支持桌面版和 IDE 插件。

#### 安装与配置

```bash
# 安装

npm install -g @openai/codex

# 使用 ChatGPT 账户登录（Plus/Pro/Team/Enterprise）

codex --login

# 或配置 API Key

export OPENAI_API_KEY="sk-xxx"
```

#### 三种审批模式

Codex CLI 的核心设计理念是**分级自主权**，提供三种审批模式：

| 模式 | 行为 | 适用场景 |
|------|------|---------|
| **Suggest** | 所有操作需人工审批 | 敏感代码、学习阶段 |
| **Auto Edit** | 自动编辑文件，执行命令需审批 | 日常开发 |
| **Full Auto** | 在沙箱中完全自主执行 | 批量任务、CI/CD |

```bash
# 建议模式（默认）

codex "优化这个函数的性能"

# 全自动模式（在沙箱中运行）

codex --full-auto "为所有 API 端点添加输入验证"
```

#### 基本使用

```bash
# 分析代码库

codex "解释这个项目的架构"

# 修复 Bug

codex "修复 issue #42 中描述的内存泄漏"

# 生成 PR

codex "实现这个 feature request 并创建 Pull Request"

# 多模态输入（支持截图）

codex "按照这个设计稿实现页面" --image design.png
```

#### 交互模式与对话管理

Codex CLI 支持全屏终端 UI 和本地对话存档：

```bash
# 启动交互模式

codex

> 帮我理解 src/auth/ 的认证流程
[分析中...展示执行计划，等待审批]

> 批量重命名所有测试文件为 *_test.py 格式
[执行计划: 修改 23 个文件，是否继续？]

# 恢复上次对话

codex --resume
```

#### 项目配置

通过 `AGENTS.md` 或 `codex.md` 提供项目级指令：

```markdown
# AGENTS.md

## 项目信息

- 名称: MyProject
- 语言: TypeScript + Python

## 代码规范

- 使用 ESLint + Prettier
- 测试使用 Vitest
- 提交遵循 Conventional Commits

## 安全限制

- 禁止修改生产配置
- 禁止直接操作数据库
```

### 10.3.6 工具对比

#### 功能对比

图 10-11：智能体编程工具功能对比

| 功能 | Copilot Agent | Cursor | Claude Code | Codex | Cline |
|------|--------------|--------|-------------|-------|-------|
| 交互方式 | GitHub Web / VS Code | IDE 原生 | CLI / IDE 插件 / 桌面应用 | CLI / IDE 插件 / 桌面应用 | VS Code 插件 |
| 全代码库理解 | ✅ | ✅ | ✅ | ✅ | ✅ |
| 规划模式 | ❌ | ✅ | ✅ | ✅ | ✅ |
| MCP 协议支持 | ✅ | ✅ | ✅ | ✅ | ✅ |
| Git 集成 | ✅ 深度 | ✅ | ✅ | ✅ | ✅ |
| 自定义规则 | ✅ Instructions | ✅ Rules | ✅ CLAUDE.md | ✅ AGENTS.md | ✅ .clinerules |
| 技能系统 | ❌ | ✅ Skills | ✅ Skills | ✅ Skills | ✅ Skills |
| 多模型支持 | ✅ | ✅ | ❌ Claude only | ✅ | ✅ |
| 审批分级 | ❌ | ❌ | ✅ 三级 | ✅ 三级 | ✅ 可配置 |
| 多模态输入 | ✅ | ✅ | ✅ | ✅ | ✅ |
| 离线使用 | ❌ | ❌ | ❌ | ❌ | ✅ (支持本地模型) |

> **其它工具**：除了上述工具，还涌现了如 **Windsurf** 和 **Trae** (字节跳动) 等采用 "Cascade/Flow" 流式范式的 IDE，强调实时上下文感知而非单纯的对话交互，也是值得关注的选择。

#### 场景选择指南

根据不同任务选择合适的工具：


```mermaid
graph LR
    Task[我的任务是什么?]
    
    Task --> Daily[日常开发/多文件编辑]
    Daily --> Cursor[Cursor]
    
    Task --> DevOps[DevOps/脚本/终端]
    DevOps --> Claude[Claude Code]
    
    Task --> GitHub[GitHub 工作流]
    GitHub --> Copilot[Copilot Agent]
    
    Task --> Auto[批量自动化任务]
    Auto --> Codex[Codex CLI Full Auto]
    
    Task --> Privacy[数据隐私优先]
    Privacy --> Cline[Cline + 本地模型]
    
    Task --> Mix[混合使用]
    Mix --> Multi[Cursor + 多模型]
```

图 10-12：智能体编程工具选择决策树

### 10.3.7 工具组合策略

在实际项目中，可以组合使用多个工具：

```mermaid
graph TD
    Cursor[1. Cursor<br>日常开发和代码编写] --> Claude[2. Claude Code / Codex CLI<br>CI/CD 中的自动化任务]
    Claude --> Copilot[3. Copilot Agent<br>GitHub 流程自动化]
```

图 10-13：多工具组合协作策略

#### 配置统一

通过 AGENTS.md 统一各工具的行为：

```markdown
# AGENTS.md

## 项目信息

- 名称: MyProject
- 语言: TypeScript, Python

## 代码约定

- 全部工具遵循此规范

## 安全限制

- 禁止修改 .env 文件
- 禁止直接操作生产数据库
```

---

**下一节**: [开发方法论](10.4_workflow.md)
