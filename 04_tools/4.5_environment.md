## 4.5 环境交互：代码解释器与浏览器操作

智能不仅需要"大脑"（模型），更需要"双手"（执行环境）。**代码解释器（Code Interpreter）** 赋予了 Agent 精确计算和数据分析的能力，而 **计算机操作（Computer Use）** 则让 Agent 能够像人类一样操控 GUI 界面，打破了 API 的限制。本节将探讨这两大核心交互能力。

### 4.5.1 代码解释器 (Code Interpreter)

代码解释器（Code Interpreter）的核心是让 LLM 从"说话者"变成了"行动者"。它不仅能写代码，还能**运行**代码。

#### 核心价值
1.  **弥补数学短板**：LLM 是概率模型，不擅长精确计算。通过代码解释器，Agent 可以运行 `print(248 * 1923)` 得到 100% 正确的结果。
2.  **精确数据分析**：面对百万行 CSV 数据，Agent 可以编写 Pandas 代码进行清洗、聚合和分析，而非受限于上下文窗口。
3.  **多模态输出**：通过调用 Matplotlib 或 MoviePy，Agent 可以生成图表、视频或文档 (.docx/.xlsx)。

#### 工作原理与沙箱
代码解释器的本质是一个 REPL (Read-Eval-Print Loop)。为了防止 `rm -rf /` 等危险操作，它必须运行在严格隔离的沙箱中：

-   **Docker 容器**：行业标准。每个 Session 启动独立容器，限制 CPU/内存，通常默认禁用网络。
-   **WebAssembly (WASM)**：在浏览器端通过 Pyodide 运行，绝对安全但在性能和库支持上有限制。
-   **云原生沙箱 (E2B 等)**：提供毫秒级启动的微虚拟机 (MicroVM)，适合生产环境。

### 4.5.2 浏览器自动化与计算机操作（Computer Use）

并非所有系统都开放 API。遗留系统（ERP/CRM）和现代 SaaS 往往只有 Web 界面。**浏览器自动化**让 Agent 能通过 UI 与这些系统交互。

#### 从 DOM 到 视觉感知
-   **传统自动化 (Playwright/Selenium)**：基于 DOM 结构（CSS/XPath 选择器）。
    -   *优点*：精确、速度快。
    -   *缺点*：脆弱（页面微调即失效），需要 Agent 理解复杂的 HTML 结构。
-   **计算机操作（Computer Use，Anthropic）**：基于视觉（Vision）的 GUI 控制。
    -   Agent 直接"看"屏幕截图，输出鼠标移动 `(x, y)`、点击、键盘输入等指令。
    -   *优点*：通用性强（像人一样操作任意软件），无需适配底层代码。
    -   *缺点*：速度较慢，成本较高。

> [!IMPORTANT]
> **OpenAI Operator**：2025年发布的生产级浏览器 Agent，结合了 CUA (Computer-Using Agent) 模型，能够自动执行订票、购物等复杂多步骤的网页任务。

### 4.5.3 安全与风险控制

赋予 Agent "手"的同时也引入了巨大风险。如果 Agent 不小心删除了数据库或发送了钓鱼邮件，后果严重。

#### 三层防御体系
1.  **环境隔离 (Isolation)**：
    -   代码必须在临时沙箱中运行。
    -   浏览器操作应在无头浏览器或隔离的虚拟机中进行。
2.  **人机回环 (Human-in-the-loop)**：
    -   **敏感操作确认**：涉及资金、数据删除的操作必须用户批准。
    -   **Takeover Mode**：检测到输入密码等敏感信息时，自动暂停让用户接管。
3.  **权限最小化**：
    -   只授予 Agent 完成任务所需的最小文件读写或网络访问权限。

### 4.5.4 案例：Cursor Visual Editor

Cursor 推出的 Visual Editor 展示了另一种交互形态：将"视觉"与"代码"结合。Agent 既能"看到"渲染后的页面，又能直接修改底层的 React 组件 Props 或 JSX 代码。这种**双向交互**代表了下一代开发工具的雏形。

### 4.5.5 小结

-   **代码解释器**是 Agent 的"左脑"，负责逻辑、数学和数据。
-   **浏览器/计算机操作（Computer Use）**是 Agent 的"手"，负责与不开放 API 的数字世界交互。
-   **安全**是环境交互的底线，必须建立完善的沙箱与鉴权机制。

下一节我们将探讨 Agent 如何通过多模态感知（视觉、听觉）来理解更丰富的世界。

---

**下一节**: [多模态感知与行动](4.6_multimodal.md)
