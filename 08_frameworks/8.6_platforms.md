## 8.6 平台级产品：OpenAI Assistants 与 Claude Artifacts

除了开源框架，主流 AI 厂商也推出了自己的智能体产品。本节解析 OpenAI 的 Assistants API 和 Anthropic Claude 的工具使用能力，探讨它们与开源方案的差异和适用场景。

### 8.6.1 OpenAI Assistants API

### 8.6.2 概述

[Assistants API](https://platform.openai.com/docs/assistants/overview) 是 OpenAI 于 2023 年 11 月推出的智能体构建平台，提供了开箱即用的智能体能力。

**核心特性**：

- 持久化的 **线程 (Thread)**
- 内置工具：**代码解释器 (Code Interpreter)**、**文件搜索 (File Search)**、**函数调用 (Function Calling)**
- 自动管理上下文
- 托管式运行环境

### 8.6.3 基本使用

具体示例如下：

```python
from openai import OpenAI

client = OpenAI()

# 1. 创建 Assistant

assistant = client.beta.assistants.create(
    name="数据分析师",
    instructions="你是一个专业的数据分析师，善于处理 CSV 和 Excel 文件。",
    model="gpt-5.3-codex",
    tools=[
        {"type": "code_interpreter"},
        {"type": "file_search"}
    ]
)

# 2. 创建对话线程

thread = client.beta.threads.create()

# 3. 添加消息

message = client.beta.threads.messages.create(
    thread_id=thread.id,
    role="user",
    content="分析上传的销售数据，找出销量最高的产品"
)

# 4. 运行 Assistant

run = client.beta.threads.runs.create(
    thread_id=thread.id,
    assistant_id=assistant.id
)

# 5. 等待完成并获取结果

import time
while run.status != "completed":
    time.sleep(1)
    run = client.beta.threads.runs.retrieve(
        thread_id=thread.id,
        run_id=run.id
    )

# 6. 获取回复

messages = client.beta.threads.messages.list(thread_id=thread.id)
print(messages.data[0].content[0].text.value)
```

### 8.6.4 内置工具详解

#### Code Interpreter

自动执行 Python 代码的能力：

```python
# 上传文件

file = client.files.create(
    file=open("sales_data.csv", "rb"),
    purpose="assistants"
)

# 创建带文件的消息

message = client.beta.threads.messages.create(
    thread_id=thread.id,
    role="user",
    content="分析这个销售数据文件，生成可视化图表",
    attachments=[{
        "file_id": file.id,
        "tools": [{"type": "code_interpreter"}]
    }]
)
```

**Code Interpreter 会自动**：

1. 读取文件内容
2. 编写分析代码
3. 执行代码生成图表
4. 返回分析结果和图片

#### 文件搜索（File Search）原 Retrieval

基于向量检索的文档问答：

```python
# 创建向量存储

vector_store = client.beta.vector_stores.create(
    name="产品文档库"
)

# 上传文档

file_batch = client.beta.vector_stores.file_batches.upload_and_poll(
    vector_store_id=vector_store.id,
    files=[open("product_manual.pdf", "rb")]
)

# 将向量存储关联到 Assistant

client.beta.assistants.update(
    assistant_id=assistant.id,
    tool_resources={
        "file_search": {"vector_store_ids": [vector_store.id]}
    }
)
```

### 8.6.5 Function Calling

自定义函数调用：

```python
# 定义函数

tools = [{
    "type": "function",
    "function": {
        "name": "get_weather",
        "description": "获取指定城市的天气",
        "parameters": {
            "type": "object",
            "properties": {
                "city": {"type": "string", "description": "城市名称"}
            },
            "required": ["city"]
        }
    }
}]

assistant = client.beta.assistants.create(
    name="天气助手",
    model="gpt-5.3-codex",
    tools=tools
)

# 处理函数调用

run = client.beta.threads.runs.create_and_poll(
    thread_id=thread.id,
    assistant_id=assistant.id
)

if run.status == "requires_action":
    tool_calls = run.required_action.submit_tool_outputs.tool_calls
    
    tool_outputs = []
    for call in tool_calls:
        if call.function.name == "get_weather":
            args = json.loads(call.function.arguments)
            result = get_weather_api(args["city"])
            tool_outputs.append({
                "tool_call_id": call.id,
                "output": result
            })
    
    # 提交结果

    client.beta.threads.runs.submit_tool_outputs(
        thread_id=thread.id,
        run_id=run.id,
        tool_outputs=tool_outputs
    )
```

### 8.6.6 Claude 的工具使用

### 8.6.7 概述

Anthropic 的 Claude 提供了强大的 [工具使用 (Tool Use)](https://docs.anthropic.com/en/docs/build-with-claude/tool-use) 能力，设计简洁且效果出色。

### 8.6.8 基本使用

具体示例如下：

```python
import anthropic

client = anthropic.Anthropic()

# 定义工具

tools = [
    {
        "name": "get_stock_price",
        "description": "获取股票的当前价格",
        "input_schema": {
            "type": "object",
            "properties": {
                "symbol": {
                    "type": "string",
                    "description": "股票代码，如 AAPL"
                }
            },
            "required": ["symbol"]
        }
    }
]

# 发送请求

response = client.messages.create(
    model="claude-opus-4.6",
    max_tokens=1024,
    tools=tools,
    messages=[
        {"role": "user", "content": "苹果公司的股价是多少？"}
    ]
)

# 处理工具调用

if response.stop_reason == "tool_use":
    tool_use = next(
        block for block in response.content 
        if block.type == "tool_use"
    )
    
    # 执行工具

    result = get_stock_price(tool_use.input["symbol"])
    
    # 发送工具结果

    final_response = client.messages.create(
        model="claude-opus-4.6",
        max_tokens=1024,
        tools=tools,
        messages=[
            {"role": "user", "content": "苹果公司的股价是多少？"},
            {"role": "assistant", "content": response.content},
            {
                "role": "user",
                "content": [{
                    "type": "tool_result",
                    "tool_use_id": tool_use.id,
                    "content": result
                }]
            }
        ]
    )
```

### 8.6.9 Claude 的计算机使用

Claude Opus 4.6 支持直接操作计算机界面：

```python
tools = [
    {
        "type": "computer_20241022",
        "name": "computer",
        "display_width_px": 1024,
        "display_height_px": 768
    },
    {
        "type": "text_editor_20241022", 
        "name": "str_replace_editor"
    },
    {
        "type": "bash_20241022",
        "name": "bash"
    }
]

response = client.messages.create(
    model="claude-opus-4.6",
    max_tokens=4096,
    tools=tools,
    messages=[{"role": "user", "content": "打开浏览器访问 google.com"}]
)
```

### 8.6.10 平台对比

### 8.6.11 能力对比

| 特性 | OpenAI Assistants | Claude Tool Use |
|------|-------------------|-----------------|
| 状态管理 | 内置 Thread | 需自行管理 |
| 代码执行 | Code Interpreter | Computer Use |
| 文件处理 | File Search | 需自定义 |
| 定价模式 | 按 Token + 存储 | 按 Token |
| 延迟 | 较高（托管） | 较低（直接调用） |

### 8.6.12 选型建议

**选择 OpenAI Assistants 的场景**：

- 需要快速原型开发
- 需要内置的代码执行和文件处理
- 需要持久化的对话管理
- 团队缺乏基础设施能力

**选择 Claude Tool Use 的场景**：

- 需要低延迟响应
- 需要更精细的控制
- 有复杂的自定义工具需求
- 成本敏感的场景

**选择开源框架的场景**：

- 需要完全的控制权
- 需要本地部署
- 需要与多种模型集成
- 有特殊的合规要求

### 8.6.13 小结

平台级产品降低了智能体开发的门槛：

| 产品 | 核心优势 | 适用团队 |
|------|----------|----------|
| OpenAI Assistants | 开箱即用 | 快速验证想法 |
| Claude Tool Use | 简洁高效 | 注重质量和成本 |
| 开源框架 | 完全控制 | 生产级应用 |

选择建议：**先用平台级产品验证想法，再用开源框架构建生产系统**。

本章介绍了主流的智能体开发框架，下一章我们将探讨如何将这些智能体系统工程化落地。

---

**下一节**: [本章小结](summary.md)
